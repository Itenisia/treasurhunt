<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Classement Elo</title>
  <style>
    :root { --bg:#0b1021; --card:#121933; --accent:#6cf; --text:#e9ecf4; --muted:#9da4c9; --danger:#f66; }
    body { margin:0; font-family:"Segoe UI", sans-serif; background: radial-gradient(circle at 20% 20%, #18244d, #0b1021 50%), #0b1021; color: var(--text); }
    header { padding:20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid rgba(255,255,255,0.08); }
    h1 { margin:0; }
    a.btn { color:#041126; background:var(--accent); padding:10px 14px; border-radius:10px; text-decoration:none; font-weight:700; }
    .card { margin:20px; background:var(--card); border-radius:14px; padding:18px; border:1px solid rgba(255,255,255,0.05); box-shadow:0 10px 25px rgba(0,0,0,0.35); }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:10px; text-align:left; border-bottom:1px solid rgba(255,255,255,0.05); }
    th { color:var(--muted); font-weight:600; }
    .pill { padding:4px 8px; border-radius:12px; background:rgba(255,255,255,0.08); display:inline-block; font-size:12px; }
    .muted { color:var(--muted); }
    .attackable { background: rgba(74,222,128,0.08); }
    .blocked { background: rgba(239,68,68,0.08); color: #fca5a5; }
    .attack-link { color:#4ade80; text-decoration:none; font-weight:700; }
    .attack-link:hover { text-decoration:underline; }
    .tooltip-card { position:absolute; z-index:10; background:var(--card); border:1px solid rgba(255,255,255,0.08); padding:10px; border-radius:10px; box-shadow:0 10px 20px rgba(0,0,0,0.35); width:240px; display:none; }
    .tooltip-card h4 { margin:0 0 6px; font-size:14px; }
    .tooltip-card .muted { font-size:12px; }
    .relative { position:relative; }
  </style>
</head>
<body>
  <header>
    <h1>Classement Elo des armées</h1>
    <a class="btn" href="/siege/">Retour QG</a>
  </header>
  <div class="card">
    <table>
      <thead>
        <tr><th>#</th><th>Armée</th><th>Commandant</th><th>Elo</th><th>Badge</th><th>Défier</th></tr>
      </thead>
      <tbody>
        {% for army in armies %}
          <tr class="{% if army.can_attack %}attackable{% else %}blocked{% endif %}">
            <td>{{ army.rank }}</td>
            <td class="relative">
              <a href="/siege/profile/{{ army.id }}/" class="attack-link" data-army-id="{{ army.id }}">{{ army.name }}</a>
              <div class="tooltip-card" id="card-army-{{ army.id }}">
                <h4>{{ army.name }}</h4>
                <div class="muted">Commandant : {% if army.commander %}{{ army.commander.name }}{% else %}—{% endif %}</div>
                <div style="margin-top:6px;">
                  <div class="muted">Unités :</div>
                  <div>
                    {% for unit in army_cards|dict_get:army.id.units %}
                      <span class="pill">{{ unit }}</span>
                    {% empty %}
                      <span class="muted">Aucune unité</span>
                    {% endfor %}
                  </div>
                </div>
                <div style="margin-top:6px;">
                  <div class="muted">Améliorations :</div>
                  <div>
                    {% for up in army_cards|dict_get:army.id.upgrades %}
                      <span class="pill">{{ up }}</span>
                    {% empty %}
                      <span class="muted">Aucune amélioration</span>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </td>
            <td class="relative">
              {% if army.commander %}
                <a href="/siege/profile/{{ army.id }}/" class="attack-link" data-army-id="{{ army.id }}">{{ army.commander.name }}</a>
              {% else %}
                —
              {% endif %}
            </td>
            <td>{{ army.elo }}</td>
            <td><span class="pill">{{ army.badge }}</span></td>
            <td>
              {% if army.can_attack and army.attack_url %}
                <a class="attack-link" href="{{ army.attack_url }}">Défier</a>
              {% elif default_army and army.commander_id == default_army.commander_id %}
                <span class="muted">Votre armée</span>
              {% else %}
                <span class="muted">Cooldown</span>
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="5" class="muted">Aucune armée pour l'instant.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <script>
    document.querySelectorAll('[data-army-id]').forEach(link => {
      const id = link.dataset.armyId;
      const card = document.getElementById(`card-army-${id}`);
      if (!card) return;
      link.addEventListener('mouseenter', () => { card.style.display = 'block'; });
      link.addEventListener('mouseleave', () => { card.style.display = 'none'; });
      link.addEventListener('focus', () => { card.style.display = 'block'; });
      link.addEventListener('blur', () => { card.style.display = 'none'; });
    });
  </script>
</body>
</html>
